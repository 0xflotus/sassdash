
@import 'utilities/_static';

@mixin initialize() {
    $void: const-set('html-escapes', (
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#39;',
            '`': '&#96;'
        ));
    $void: const-set('html-unescapes', (
            '&amp;': '&',
            '&lt;': '<',
            '&gt;': '>',
            '&quot;': '"',
            '&#39;': "'",
            '&#96;': '`'
        ));
    $void: const-set('string-escapes', (
            '\\': '\\',
            "'": "'",
            '\n': 'n',
            '\r': 'r',
            '\u2028': 'u2028',
            '\u2029': 'u2029'
        ));
}

@include initialize();

@function __base-compare-ascending($value, $other) {
    @if $value > $other {
        @return 1;
    }

    @if $value < $other {
        @return -1;
    }

    @return 0;
}

@function __base-index-of($list, $value, $from-index: 1) {
    $length: length($list);
    $index: $from-index;

    @while $index <= $length {
        @if (nth($list, $index) == $value) {
            @return $index;
        }

        $index: $index + 1;
    }

    @return -1;
}

@function __base-sort-by() { /* TODO */ }

@function __char-at-callback($string) {
    // ... 
}

@function __STRING-char-at($string, $index) {
    @return str-slice($string, $index, $index);
}

@function __chars-index($string, $chars, $direction) {
    $index: 1;
    $length: str-length($string);
    $direction-map: ('right': -1, 'left': 1);
    $increment: map-get($direction-map, $direction);

    @while str-index($chars, __STRING-char-at($string, $index))
        and $index <= $length {
        $index: $index + $increment;
    }

    @return $index;
}

@function __chars-left-index($string, $chars) {
    @return __chars-index($string, $chars, $direction: left);
}

@function __chars-right-index($string, $chars) {
    @return __chars-index($string, $chars, $direction: right);
}

@function __compare-ascending($map, $other) {
    // TODO
}

@function __compare-multiple-ascending($map, $other) {
    // TODO
}

@function __escape-html-char($char) {
    @return const-get('html-escapes' $char);
}

@function __escape-string-char($char) {
    @return '\\#{const-get('string-escapes' $char)}';
}

@function __index-of-nan($list, $from-index, $from-right) {
    // TODO
}

@function __is-index($value, $length) {
    @return $value > -1
        and $value % 1 == 0
        and ($length == null or $value < $length);
}

@function __is-map-like($value) {
    @return $value and (type-of($value) == map);
}

@function __is-space($char-code) {
    // TODO - find the rest of the space characters
    @return $char-code == ' ';
}

@function __replace-holders($list, $placeholder) {
    // TODO
}

@function __sorted-uniq($list, $iteratee: null) {
    $seen: null;
    $index: 1;
    $length: length($list);
    $res-index: 1;
    $result: ();

    @while ($index <= $length) {
        $value: nth($list, $index);
        $computed: if($iteratee, call($iteratee, $value, $index, $list), $value);

        @if not ($seen == $computed) {
            $seen: $computed;
            $result: append($result, $value);
        }

        $res-index: $res-index + 1;
        $index: $index + 1;
    }

    @return $result;
}

@function __trimmed-left-index($string) {
    $index: 1;
    $length: str-length($string);

    @while ($index <= $length) and (__is-space(__STRING-char-at($string, $index))) {
        $index: $index + 1;
    }

    @return $index;
}

@function __trimmed-right-index($string) {
    $index: str-length($string);

    @while ($index > 0) and (__is-space(__STRING-char-at($string, $index))) {
        $index: $index - 1;
    }

    @return $index;
}

@function __unescape-html-char($char) {
    @return const-get('html-unescapes' $char);
}

// SASSDASH
// ========

@function __sassdash($value) {
    @if (__is-map-like($value) && not type-of($value) == list) {
        @if (instanceof($value, 'SassdashWrapper')) {
            @return $value;
        }
    }

    @return new('SassdashWrapper', (
        value: $value
    ));
}

@function SassdashWrapper($value, $chain-all: false, $actions: ()) {
    @return (
        __actions__: $actions,
        __chain__: if($chain-all, true, false),
        __wrapped__: $value
    );
}


